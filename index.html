<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pedidos</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/vanilla-masker@1.1.1/lib/vanilla-masker.js"></script>
</head>
<body>
    <!-- ... resto do HTML permanece igual ... -->

    <script>
        window.onload = function() {
            // Máscaras permanecem iguais
            var telefoneInput = document.getElementById('telefone');
            VMasker(telefoneInput).maskPattern('(99) 99999-9999');

            var valorInput = document.getElementById('valor');
            VMasker(valorInput).maskMoney({
                precision: 2,
                separator: ',',
                delimiter: '.',
                unit: 'R$ '
            });
        }

        function imprimirPedido() {
            // Coleta os dados do formulário
            const nome = document.getElementById('nome').value;
            const telefone = document.getElementById('telefone').value;
            const produtos = document.getElementById('produtos').value;
            const pagamento = document.getElementById('pagamento').value;
            const endereco = document.getElementById('endereco').value;
            const valor = document.getElementById('valor').value;

            // Formata o texto para impressão
            const textoImpressao = 
                "PEDIDO\n" +
                "=================\n" +
                `Cliente: ${nome}\n` +
                `Telefone: ${telefone}\n` +
                `\nProdutos:\n${produtos}\n` +
                `\nForma de Pagamento: ${pagamento}\n` +
                `Endereço: ${endereco}\n` +
                `Valor Total: ${valor}\n` +
                "=================\n\n";

            try {
                // Cria um arquivo Blob com o texto
                const blob = new Blob([textoImpressao], { type: 'text/plain' });
                
                // Cria uma URL temporária para o arquivo
                const fileUrl = URL.createObjectURL(blob);

                // Cria um link para download (opcional, para debug)
                const downloadLink = document.createElement('a');
                downloadLink.href = fileUrl;
                downloadLink.download = 'pedido.txt';
                
                // Salva o arquivo (opcional, para debug)
                // downloadLink.click();

                // Cria o link para o RawBT usando a URL do arquivo
                const printLink = document.createElement('a');
                printLink.href = 'rawbt://print?file=' + encodeURIComponent(fileUrl);
                document.body.appendChild(printLink);
                printLink.click();
                document.body.removeChild(printLink);

                // Limpa a URL temporária após um breve delay
                setTimeout(() => {
                    URL.revokeObjectURL(fileUrl);
                }, 1000);

                // Limpa todos os campos
                document.getElementById('nome').value = '';
                document.getElementById('telefone').value = '';
                document.getElementById('produtos').value = '';
                document.getElementById('pagamento').value = '';
                document.getElementById('endereco').value = '';
                document.getElementById('valor').value = '';

                // Foca no primeiro campo para novo pedido
                document.getElementById('nome').focus();
            } catch (error) {
                alert('Erro ao imprimir. Por favor, verifique se a impressora está conectada.');
                console.error(error);
            }
        }
    </script>
</body>
</html>
