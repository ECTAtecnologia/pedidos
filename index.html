<!DOCTYPE html>
<html lang="pt-BR">
<!-- ... resto do head e body permanece igual ... -->

<script>
    // ... código existente das máscaras permanece igual ...

    function imprimirPedido() {
        // Coleta os dados do formulário
        const nome = document.getElementById('nome').value;
        const telefone = document.getElementById('telefone').value;
        const produtos = document.getElementById('produtos').value;
        const pagamento = document.getElementById('pagamento').value;
        const endereco = document.getElementById('endereco').value;
        const valor = document.getElementById('valor').value;

        // Formata o texto para impressão
        const textoImpressao = 
            "PEDIDO\n" +
            "=================\n" +
            `Cliente: ${nome}\n` +
            `Telefone: ${telefone}\n` +
            `\nProdutos:\n${produtos}\n` +
            `\nForma de Pagamento: ${pagamento}\n` +
            `Endereço: ${endereco}\n` +
            `Valor Total: ${valor}\n` +
            "=================\n\n";

        try {
            // Cria um iframe oculto para impressão
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            document.body.appendChild(iframe);

            // Escreve o conteúdo no iframe
            iframe.contentWindow.document.write(`
                <html>
                <head>
                    <title>Impressão de Pedido</title>
                    <style>
                        body { font-family: monospace; white-space: pre; }
                    </style>
                </head>
                <body>
                    ${textoImpressao}
                </body>
                </html>
            `);
            iframe.contentWindow.document.close();

            // Tenta usar a API de impressão nativa primeiro
            if (iframe.contentWindow.print) {
                iframe.contentWindow.print();
                setTimeout(() => {
                    document.body.removeChild(iframe);
                }, 1000);
            } else {
                // Fallback para RawBT se a impressão nativa falhar
                document.body.removeChild(iframe);
                var link = document.createElement('a');
                link.href = 'rawbt://print?text=' + encodeURIComponent(textoImpressao);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            // Limpa todos os campos
            document.getElementById('nome').value = '';
            document.getElementById('telefone').value = '';
            document.getElementById('produtos').value = '';
            document.getElementById('pagamento').value = '';
            document.getElementById('endereco').value = '';
            document.getElementById('valor').value = '';

            // Foca no primeiro campo para novo pedido
            document.getElementById('nome').focus();
        } catch (error) {
            alert('Erro ao imprimir. Por favor, verifique se a impressora está conectada.');
            console.error(error);
        }
    }
</script>
</body>
</html>
